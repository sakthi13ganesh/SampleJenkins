def task

pipeline {
    agent any

    stages {
        stage ('Param Validation') {
            steps {
                script{
                    echo "Env Choice   : ${params.Env}"
                    echo "Suite Choice : ${params.Suite}"
                    if (params.Env.equals("Env not recognized") || params.Suite.equals("Suite not recognized")) {
                      echo "Validation Failure"
                      currentBuild.result = 'ABORTED'
                      return
                    }
                    echo "Param Validation Successful"
                }
            }
        }

        stage ('Running Test suite') {
            steps {
                script{
                    task = ${params.Env}=="QA"?"testOnQa":"testOnStage"
                    sh "./gradlew clean ${task} -PsuiteNature=${params.Suite}"
                }
            }
        }

        stage ('Posting Results') {
            steps {
                junit 'build/test-results/${task}/*.xml'
            }
        }
    }

}